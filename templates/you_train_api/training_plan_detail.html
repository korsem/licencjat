{% extends 'main/base.html' %}

{% block title %}{{ training_plan.title }}{% endblock %}

{% block content %}
<h1>{{ training_plan.title }}</h1>

<p>{{ training_plan.description }}</p>

{% if training_plan.goal %}
<p><strong>Goal:</strong> {{ training_plan.goal }}</p>
{% endif %}

<p><strong>Start Date:</strong> {{ workout_plan.start_date }}</p>

{% if workout_plan.is_cyclic %}
<p><strong>Cycle Length:</strong> {{ workout_plan.cycle_length }} weeks</p>
{% else %}
<p><strong>End Date:</strong> {{ workout_plan.end_date }}</p>
{% endif %}

{% if training_plan.is_active %}
<p><strong style="color: green;">This is the active training plan</strong></p>
<form method="post" style="display:inline;">
    {% csrf_token %}
    <button type="submit" name="deactivate" class="btn btn-warning" onclick="return confirmDeactivation();">Deactivate Plan</button>
</form>
{% else %}
<form method="post" style="display:inline;">
    {% csrf_token %}
    <button type="submit" name="set_active" class="btn btn-primary" onclick="return confirmActivation();">Set as Active</button>
</form>
{% endif %}

<form method="post" action="{% url 'delete_training_plan' training_plan.id %}" style="display:inline;" onsubmit="return confirmDelete();">
    {% csrf_token %}
    <button type="submit" class="btn btn-danger">Delete Plan</button>
</form>

<a href="{% url 'training_plan_list' %}" class="btn btn-secondary mt-4">Back to Training Plans</a>

<h2>Exercises</h2>
{% if workout_plan.is_cyclic %}
    <h3>Week Schedule</h3>
    {% for i in week_days %}
        <h4>{{ i|date:"l" }}</h4>
        <ul>
        {% for workout_in_plan in workouts_in_plan %}
            {% if workout_in_plan.day_of_week == i %}
                <li>{{ workout_in_plan.workout.title }}</li>
            {% endif %}
        {% endfor %}
        </ul>
    {% endfor %}
{% else %}
    <h3>Daily Schedule</h3>
    <ul>
    {% for workout_in_plan in workouts_in_plan %}
        <li>{{ workout_in_plan.date }} - {{ workout_in_plan.workout.title }}</li>
    {% endfor %}
    </ul>
{% endif %}

<script>
    function confirmDelete() {
        return confirm('Are you sure you want to delete the plan "{{ training_plan.title }}"? This action cannot be undone.');
    }

    function confirmActivation() {
        {% if confirm %}
            return confirm('There is already an active plan. Setting this plan as active will deactivate the current active plan. Are you sure you want to proceed?');
        {% else %}
            return true;
        {% endif %}
    }

    function confirmDeactivation() {
        return confirm('Are you sure you want to deactivate this plan?');
    }
</script>

{% endblock %}
